# Firebase App Hosting configuration for Backstage backend
# For monorepo: backend code is in packages/backend/
runConfig:
  minInstances: 0
  maxInstances: 10
  concurrency: 1000
  cpu: 1
  memoryMiB: 2048
  timeoutSeconds: 3600

env:
  - variable: NODE_ENV
    value: production
  - variable: BACKEND_SECRET
    secret: BACKEND_SECRET
  - variable: GOOGLE_CLIENT_ID
    secret: GOOGLE_CLIENT_ID  
  - variable: GOOGLE_CLIENT_SECRET
    secret: GOOGLE_CLIENT_SECRET
  - variable: GITHUB_TOKEN
    secret: GITHUB_TOKEN
  - variable: POSTGRES_HOST
    secret: POSTGRES_HOST
  - variable: POSTGRES_PORT
    value: "5432"
  - variable: POSTGRES_USER
    secret: POSTGRES_USER
  - variable: POSTGRES_PASSWORD
    secret: POSTGRES_PASSWORD
  - variable: POSTGRES_DB
    secret: POSTGRES_DB

# Build and runtime configuration
scripts:
  buildCommand: yarn install --frozen-lockfile && yarn workspace backend build
  runCommand: node packages/backend/dist/index.cjs.js